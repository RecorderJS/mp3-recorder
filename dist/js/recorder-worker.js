//devin87@qq.com
//build:2019/05/23 23:40:08
!function(l){"use strict";!function(){"undefined"!=typeof console&&console.log.apply(console,arguments)}("mp3 recorder worker started!"),importScripts("./lame.all.js");var i,u,f,p,n=[];function m(e){n.push(new Int8Array(e))}function t(){n=[]}function d(e){if(f!=p)for(var a=f/p,n=Math.ceil(e.length/a),t=new Float32Array(n),r=0,o=0;r<n;o+=a)t[r++]=e[~~o];else t=new Float32Array(e);n=t.length;var s=new Int16Array(n);for(o=0;o<n;o++){var c=Math.max(-1,Math.min(1,t[o]));s[o]=c<0?32768*c:32767*c}return s}function r(){var e,a;m(i.flush()),e="complete",a=n,self.postMessage({cmd:e,data:a}),t()}self.onmessage=function(e){var a=e.data,n=a.data;switch(a.cmd){case"init":!function(e){u=e.numChannels||1,f=e.inputSampleRate,p=Math.min(e.outputSampleRate||f,f),t();var a=new lamejs;i=new a.Mp3Encoder(u,p,e.bitRate||128)}(n);break;case"encode":!function(e){for(var a=d(e[0]),n=1<u?d(e[1]):l,t=1152,r=a.length,o=0;t<=r;o+=t){var s=a.subarray(o,o+t),c=n?n.subarray(o,o+t):l;m(i.encodeBuffer(s,c)),r-=t}}(n);break;case"stop":r()}}}();