//devin87@qq.com
//build:2019/05/23 23:40:08
!function(a,l){"use strict";a.AudioContext=a.AudioContext||a.webkitAudioContext;var v=a.MediaRecorder,r=navigator.mediaDevices;r&&r.getUserMedia;function e(e){e=e||{};var t=this;t.bufferSize=e.bufferSize||16384,t.numChannels=e.numChannels||1,t.bitRate=e.bitRate||128,t.ops=e,t.support=!!(a.AudioContext&&navigator.getUserMedia&&a.Worker)}r&&r.getUserMedia?navigator.getUserMedia=function(e,t,a){return r.getUserMedia(e).then(t).catch(a)}:navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),e.prototype={constructor:e,start:function(p,e){var u=this;if(!u.support)return e&&e({code:"NOT_SUPPORTED_ERROR"});var d=u.ops,m=d.complete,f=d.error;navigator.getUserMedia({audio:!0,video:!1},function(e){if(v&&!1!==d.useMediaRecorder){var t=d.recorderType,a=new v(e,t&&v.isTypeSupported(t)?{mimeType:t}:l),r=[];a.addEventListener("dataavailable",function(e){u._paused||0<e.data.size&&r.push(e.data)}),a.addEventListener("stop",function(){var e=u.ops.complete,t=r[0],a=t&&(t.type||"").match(/^[^\/]+\/([^;]+);?.*?$/)[1]||"";e&&e(t,a?"."+a:"")}),a.start(),u.recorder=a}else{var o=new AudioContext,n=new Worker(d.WORKER_PATH||"js/recorder-worker.js");n.onmessage=function(e){var t=e.data,a=t.data;switch(t.cmd){case"complete":m&&m(new Blob(a,{type:"audio/mp3"}),".mp3");break;case"error":f&&f(a)}},u.inputSampleRate=o.sampleRate,u.outputSampleRate=d.sampleRate||u.inputSampleRate,n.postMessage({cmd:"init",data:{numChannels:u.numChannels,sampleBits:u.sampleBits,inputSampleRate:u.inputSampleRate,outputSampleRate:u.outputSampleRate,bitRate:u.bitRate}}),u.context=o,u.worker=n;var s=u.numChannels,i=o.createMediaStreamSource(e),c=(o.createScriptProcessor||o.createJavaScriptNode).call(o,u.bufferSize,s,s);c.onaudioprocess=function(e){if(!u._paused){for(var t=[],a=0;a<s;a++)t.push(e.inputBuffer.getChannelData(a));n.postMessage({cmd:"encode",data:t})}},i.connect(c),c.connect(o.destination),u.source=i,u.processor=c}"function"==typeof p&&p()},e)},pause:function(){this._paused=!0},resume:function(){this._paused=!1},stop:function(){var e=this;e.recorder&&e.recorder.stop(),e.source&&e.source.disconnect(),e.processor&&e.processor.disconnect(),e.worker&&e.worker.postMessage({cmd:"stop"})}},a.MP3Recorder=e}(window);