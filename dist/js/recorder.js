//devin87@qq.com
//build:2019/09/27 18:30:46
!function(a,f){"use strict";a.AudioContext=a.AudioContext||a.webkitAudioContext;var v=a.MediaRecorder,r=navigator.mediaDevices;r&&r.getUserMedia;function e(e){e=e||{};var t=this;t.bufferSize=e.bufferSize||16384,t.numChannels=e.numChannels||1,t.bitRate=e.bitRate||128,t.ops=e,t.support=!!(a.AudioContext&&navigator.getUserMedia&&a.Worker)}r&&r.getUserMedia?navigator.getUserMedia=function(e,t,a){return r.getUserMedia(e).then(t).catch(a)}:navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),e.prototype={constructor:e,start:function(u,e){var p=this;if(!p.support)return e&&e({code:"NOT_SUPPORTED_ERROR"});var d=p.ops,m=d.complete,l=d.error;return navigator.getUserMedia({audio:!0,video:!1},function(e){if(v&&d.useMediaRecorder){var t=d.recorderType,a=new v(e,t&&v.isTypeSupported(t)?{mimeType:t}:f),r=[];a.addEventListener("dataavailable",function(e){p._paused||0<e.data.size&&r.push(e.data)}),a.addEventListener("stop",function(){var e=p.ops.complete,t=r[0],a=t&&(t.type||"").match(/^[^\/]+\/([^;]+);?.*?$/)[1]||"";e&&e(t,a?"."+a:"")}),a.start(),p.recorder=a}else{var o=new AudioContext,n=new Worker(d.WORKER_PATH||"js/recorder-worker.js");n.onmessage=function(e){var t=e.data,a=t.data;switch(t.cmd){case"complete":m&&m(new Blob(a,{type:"audio/mp3"}),".mp3");break;case"error":l&&l(a)}},p.inputSampleRate=o.sampleRate,p.outputSampleRate=d.sampleRate||p.inputSampleRate,n.postMessage({cmd:"init",data:{numChannels:p.numChannels,sampleBits:p.sampleBits,inputSampleRate:p.inputSampleRate,outputSampleRate:p.outputSampleRate,bitRate:p.bitRate}}),p.context=o,p.worker=n;var s=p.numChannels,i=o.createMediaStreamSource(e),c=(o.createScriptProcessor||o.createJavaScriptNode).call(o,p.bufferSize,s,s);c.onaudioprocess=function(e){if(!p._paused){for(var t=[],a=0;a<s;a++)t.push(e.inputBuffer.getChannelData(a));n.postMessage({cmd:"encode",data:t})}},i.connect(c),c.connect(o.destination),p.source=i,p.processor=c,"suspended"==p.context.state&&p.context.resume()}"function"==typeof u&&u()},e),p},pause:function(){return this._paused=!0,this.context&&this.context.suspend(),this},resume:function(){return this._paused=!1,this.context&&this.context.resume(),this},stop:function(){var e=this;return e.recorder&&e.recorder.stop(),e.source&&e.source.disconnect(),e.processor&&e.processor.disconnect(),e.context&&e.context.close(),e.worker&&e.worker.postMessage({cmd:"stop"}),e}},a.MP3Recorder=e}(window);